{% extends 'base.html' %}
{% load static %}
{% load jalali %}
{% block title %}فروشگاه - استیرا{% endblock %}

{% block content %}
<section class="section page-hero">
  <div class="container">
    <h1>فروشگاه</h1>
    <p>بهترین تجهیزات و لوازم فروشگاهی را با ارسال سریع و پشتیبانی دائمی تهیه کنید.</p>

    <div class="shop-filters">
      <form method="get" class="filters">
        <div class="filter-row">
          <div class="filter-group">
            <label>دسته‌بندی</label>
            <select name="category">
              <option value="">همه دسته‌ها</option>
              {% for cat in categories %}
                <option value="{{ cat.id }}" {% if request.GET.category == cat.id|stringformat:'s' %}selected{% endif %}>
                  {{ cat.name }}
                </option>
              {% endfor %}
            </select>
          </div>
          <div class="filter-group">
            <label>جستجو در دامنه / کلمات کلیدی</label>
            <input type="text" name="domain" placeholder="مثال: یخچال، فر، ..." value="{{ request.GET.domain }}">
          </div>
          <div class="filter-group">
            <button class="btn btn-primary small" type="submit">اعمال فیلتر</button>
          </div>
        </div>

        <div class="filter-tags">
          <span class="filter-label">پیشنهاد جستجو:</span>
          <button type="button" class="filter-chip" data-tag="یخچال">یخچال</button>
          <button type="button" class="filter-chip" data-tag="فر پیتزا">فر پیتزا</button>
          <button type="button" class="filter-chip" data-tag="ویترین">ویترین</button>
          <button type="button" class="filter-chip" data-tag="سینی">سینی</button>
          <button type="button" class="filter-chip" data-tag="سرخ‌کن">سرخ‌کن</button>
        </div>
      </form>
    </div>
  </div>
</section>

<section class="section">
  <div class="container">
    <div class="products-grid">
      {% for product in products %}
        <div class="product-card" data-product-card data-href="{% url 'product_detail' product.id %}">
          <div class="product-image">
            <img src="{% static 'img/product-placeholder.jpg' %}" alt="{{ product.name }}">
          </div>

          <div class="product-info">
            <h3>{{ product.name }}</h3>
            <p class="product-domain">{{ product.domain }}</p>
            <p class="product-price">{{ product.price|money }} تومان</p>

            <div class="product-actions" data-no-card-nav>
              <a href="{% url 'add_to_compare' product.id %}" class="btn btn-outline small">مقایسه</a>
            </div>
          </div>

          <div class="product-card-cart" data-no-card-nav>
            <div class="checkbox-container">
              <div class="checkbox-wrapper">
                <input
                  class="checkbox"
                  id="cart-toggle-{{ product.id }}"
                  type="checkbox"
                  data-cart-toggle
                  data-product-id="{{ product.id }}"
                  data-add-url="{% url 'add_to_cart' product.id %}?next={{ request.get_full_path|urlencode }}&qty=1"
                  data-remove-url="{% url 'cart_remove' %}"
                  {% if product.id in cart_product_ids %}checked{% endif %}
                />
                <label class="checkbox-label" for="cart-toggle-{{ product.id }}">
                  <div class="checkbox-flip">
                    <div class="checkbox-front" aria-hidden="true">
                      <svg fill="white" height="28" width="28" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path
                          d="M19 13H12V19H11V13H5V12H11V6H12V12H19V13Z"
                          class="icon-path"
                        ></path>
                      </svg>
                    </div>
                    <div class="checkbox-back" aria-hidden="true">
                      <svg fill="white" height="28" width="28" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path
                          d="M9 19l-7-7 1.41-1.41L9 16.17l11.29-11.3L22 6l-13 13z"
                          class="icon-path"
                        ></path>
                      </svg>
                    </div>
                  </div>
                </label>
              </div>
            </div>
          </div>
        </div>
      {% empty %}
        <p class="empty-text">محصولی یافت نشد.</p>
      {% endfor %}
    </div>
  </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
  document.querySelectorAll('.filter-chip').forEach(chip => {
    chip.addEventListener('click', () => {
      const tag = chip.dataset.tag;
      const input = document.querySelector('input[name="domain"]');
      input.value = tag;
      input.form.submit();
    });
  });
</script>
<script src="{% static 'js/shop.js' %}"></script>
{% endblock %}
