{% load static %}
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="utf-8">
<title>{% block title %}آیدین شاپ{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body class="body"
      data-user-authenticated="{% if user.is_authenticated %}true{% else %}false{% endif %}"
      data-user-id="{% if user.is_authenticated %}{{ user.id }}{% endif %}">

<header class="main-header">
    <div class="container nav-container">
        <button id="sidebar-toggle" class="sidebar-toggle" aria-label="باز کردن منو">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <a href="{% url 'home' %}" class="logo">
            <span class="logo-icon">آی</span>
            <span class="logo-text light">آیدین شاپ</span>
        </a>
    </div>
</header>

<div id="sidebar-overlay" class="sidebar-overlay"></div>
<aside id="app-sidebar" class="app-sidebar">
    <div class="sidebar-inner">
        <div class="sidebar-head">
            <div class="sidebar-brand">
                <span class="logo-icon">آی</span>
                <div>
                    <div class="brand-title">آیدین شاپ</div>
                    <div class="brand-subtitle">مسیر خرید راحت</div>
                </div>
            </div>
            <button id="sidebar-close" class="sidebar-close" aria-label="بستن منو">×</button>
        </div>

        <div class="sidebar-user">
            {% if user.is_authenticated %}
                <div class="avatar">{{ user.username|first|upper }}</div>
                <div>
                    <div class="user-name-strong">{{ user.username }}</div>
                    <div class="user-muted">خوش آمدید</div>
                </div>
            {% else %}
                <div class="avatar ghost">?</div>
                <div>
                    <div class="user-name-strong">میهمان</div>
                    <div class="user-muted">برای تجربه بهتر وارد شوید</div>
                </div>
            {% endif %}
        </div>

        <nav class="sidebar-menu">
            <a href="{% url 'home' %}">
                <span class="icon">🏠</span>
                <span>خانه</span>
            </a>
            <a href="{% url 'shop' %}">
                <span class="icon">🛍️</span>
                <span>فروشگاه</span>
            </a>
            <a href="{% url 'news_list' %}">
                <span class="icon">📰</span>
                <span>اخبار</span>
            </a>
            <a href="{% url 'faq' %}">
                <span class="icon">❓</span>
                <span>سوالات متداول</span>
            </a>
            <a href="{% url 'contact' %}">
                <span class="icon">📞</span>
                <span>تماس با ما</span>
            </a>
            {% if user.is_staff %}
            <a href="{% url 'admin_chat' %}">
                <span class="icon">💬</span>
                <span>پنل چت ادمین</span>
            </a>
            {% endif %}
        </nav>

        <div class="sidebar-cta">
            <a href="{% url 'cart' %}" class="btn btn-primary full">سبد خرید</a>
            {% if user.is_authenticated %}
                <a href="{% url 'logout' %}" class="btn btn-outline full">خروج</a>
            {% else %}
                <a href="{% url 'login' %}" class="btn btn-outline full">ورود</a>
                <a href="{% url 'signup' %}" class="btn btn-light full">ثبت نام</a>
            {% endif %}
        </div>
    </div>
</aside>

<main>
    {% block content %}{% endblock %}
</main>

<footer class="main-footer">
    <div class="container footer-top">
        <div class="footer-brand">
            <h4>А?Д?А?Д?Б? А?А?Б?</h4>
            <p>Б?А?Б?А? А?А?АФАФД? А?А?Б?Д?АЩА?А? А?А?Б?АЩА?А?Б?Б? АФБ?А?А?Д? А?А? Б?А?А?Д?А?А?Б?Д? Б?А?Б?А?Д?.</p>
        </div>
        <div class="footer-column">
            <h4>А?А?А?А?А?Д? А?А?Д?А?</h4>
            <a href="{% url 'shop' %}">Б?А?Б?А?Ц?А?Б?</a>
            <a href="{% url 'news_list' %}">А?А?А?А?А?</a>
            <a href="{% url 'faq' %}">А?Б?А?Б?А?А? Б?А?А?А?Б?Б?</a>
        </div>
        <div class="footer-column">
            <h4>А?А?Б?А?А?</h4>
            <a href="{% url 'contact' %}">А?А?А?Б?А?А?А? Б?А?А?Б?А?Б?</a>
            <a href="{% url 'contact' %}">Ц?А?А?А?Б?А?Д? Б? А?А?Б?А?А? Б?А? А?АЩ Б?А?Б?А?</a>
        </div>
        <div class="footer-column">
            <h4>А?А?А?А?А?АЗ</h4>
            <p>А?Б?Б?Б?: ДЬДЩД?-xxxxxxx</p>
            <p>А?Д?Б?Д?Б?: info@example.com</p>
        </div>
    </div>
    <div class="container footer-bottom">
        <p>≥? А?Б?А?Б?Д? А?Б?Б?Б? А?А?А?Д? А?Д?А?Д?Б? А?А?Б? Б?А?Б?Б?А? А?А?А?.</p>
    </div>
</footer>

<!-- А?Ц?Б?Б? Ц?А? А?Б?А?Б?А? -->
{% if user.is_authenticated %}
<div id="global-chat-toggle" class="floating-chat-btn">
    Я???
</div>

<!-- Б?Б?Б? Ц?А? А?Б?А?Б?А? -->
<div id="global-chat-widget" class="global-chat hidden">
    <div class="global-chat-header">
        <span>Ц?А? А?Б?Б?А?Д?Б? А?А? Б?А?А?Д?А?А?Б?</span>
        <button type="button" id="global-chat-close" class="close-btn"> ?</button>
    </div>
    <div id="global-chat-messages" class="global-chat-messages">
        <!-- Б?Д?А?Б?┐??Б?А? А?Д?Б?А?А? Б?Б?А?Д?А? А?А?А?Б? Б?Д?┐??А?Б?Б?А? -->
    </div>
    <form id="global-chat-form" class="global-chat-form">
        {% csrf_token %}
        <input id="global-chat-input" type="text" placeholder="Б?Д?А?Б? А?Б?А? А?А? А?Б?Б?Д?А?Д?А?..." autocomplete="off">
        <button type="submit">А?А?А?А?Б?</button>
    </form>
</div>
{% endif %}

<!-- JavaScript -->
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js" crossorigin="anonymous"></script>
<script src="{% static 'js/chat.js' %}"></script>
<script src="{% static 'js/sidebar.js' %}"></script>
<script src="{% static 'js/theme.js' %}"></script>
{% block extra_js %}{% endblock %}
</body>
</html>
