{% load static %}
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>{% block title %}استیرا | فروشگاه آنلاین{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <link rel="icon" href="{% static 'img/logo-styra.png' %}" type="image/png">
  {% block extra_css %}{% endblock %}
  <link rel="stylesheet" href="{% static 'vendor/boxicons/css/boxicons.min.css' %}">
</head>
<body class="body" data-user-authenticated="{% if user.is_authenticated %}true{% else %}false{% endif %}">

{% if request.resolver_match.url_name == 'home' and public_promo %}
<div class="top-banner" data-banner-code="{{ public_promo.code }}">
  <div class="container top-banner-inner">
    <div class="top-banner-text">{{ public_promo.banner_text }}</div>
    <button type="button" class="top-banner-copy" data-banner-copy>کپی کد</button>
  </div>
</div>
{% endif %}

<header class="main-header">
  <div class="container nav-container">
    <button id="sidebar-toggle" class="btn sidebar-toggle-btn" aria-label="باز کردن منو">
      <span class="icon" aria-hidden="true">
        <svg viewBox="0 0 175 80" width="40" height="40" role="presentation">
          <rect width="80" height="15" fill="#f0f0f0" rx="10"></rect>
          <rect y="30" width="80" height="15" fill="#f0f0f0" rx="10"></rect>
          <rect y="60" width="80" height="15" fill="#f0f0f0" rx="10"></rect>
        </svg>
      </span>
      <span class="text">MENU</span>
    </button>

    <a href="{% url 'home' %}" class="logo">
      <picture>
        <source srcset="{% static 'img/logo-styra.webp' %}" type="image/webp">
        <img src="{% static 'img/logo-styra.png' %}" alt="لوگوی استیرا" class="logo-img" decoding="async" loading="eager" />
      </picture>
      <span class="logo-text light">استیرا</span>
    </a>

    <div class="nav-actions">
      <a href="{% url 'cart' %}" class="btn btn-light small">سبد خرید</a>

      {% if user.is_authenticated %}
        <div class="user-menu" data-user-menu>
          <button type="button" class="user-menu-trigger" aria-haspopup="menu" aria-expanded="false">
            <span class="user-name">{{ user.username }}</span>
            <i class='bx bx-chevron-down'></i>
          </button>
          <div class="user-menu-dropdown" role="menu">
            <a href="{% url 'profile' %}" role="menuitem"><i class='bx bx-user'></i> پروفایل</a>
            {% if user.is_staff %}
              <a href="{% url 'manual_invoice' %}?kind=proforma" role="menuitem"><i class='bx bxs-receipt'></i> ???? ??????????</a>
              <a href="{% url 'manual_invoice' %}?kind=invoice" role="menuitem"><i class='bx bxs-receipt'></i> ???? ??????</a>
              <a href="{% url 'admin:analytics-dashboard' %}" role="menuitem"><i class='bx bx-chart'></i> داشبورد تحلیل</a>
            {% endif %}
            <a href="{% url 'logout' %}" role="menuitem"><i class='bx bx-log-out'></i> ????</a>
          </div>
        </div>
      {% else %}
        <a href="{% url 'login' %}" class="user-profile" aria-label="User Login Button">
          <span class="user-profile-inner">
            <i class='bx bx-user' aria-hidden="true"></i>
            <p>Log In</p>
          </span>
        </a>
        <a href="{% url 'signup' %}" class="user-profile" aria-label="User Signup Button">
          <span class="user-profile-inner">
            <i class='bx bx-user' aria-hidden="true"></i>
            <p>Sign Up</p>
          </span>
        </a>
      {% endif %}
    </div>
  </div>
</header>

<div id="sidebar-overlay" class="sidebar-overlay"></div>
<aside id="app-sidebar" class="sidebar">
  <header class="sidebar-header">
    <button id="sidebar-close" class="close-btn sidebar-close-btn" aria-label="بستن منو">×</button>
  </header>
  <ul>
    <li>
      <button type="button" onclick="gotoPage(this)" data-url="{% url 'home' %}" class="active">
        <i class="bx bx-home"></i>
        <p>خانه</p>
      </button>
    </li>
    <li>
      <button type="button" onclick="gotoPage(this)" data-url="{% url 'shop' %}">
        <i class="bx bx-cart"></i>
        <p>فروشگاه</p>
      </button>
    </li>
    <li>
      <button type="button" onclick="gotoPage(this)" data-url="{% url 'news_list' %}">
        <i class="bx bx-news"></i>
        <p>اخبار</p>
      </button>
    </li>
    <li>
      <button type="button" onclick="gotoPage(this)" data-url="{% url 'about' %}">
        <i class="bx bx-info-circle"></i>
        <p>درباره ما</p>
      </button>
    </li>
    <li>
      <button type="button" onclick="gotoPage(this)" data-url="{% url 'faq' %}">
        <i class="bx bx-help-circle"></i>
        <p>سوالات متداول</p>
      </button>
    </li>
    <li>
      <button type="button" onclick="gotoPage(this)" data-url="{% url 'contact' %}">
        <i class="bx bx-phone"></i>
        <p>ارتباط با ما</p>
      </button>
    </li>
  </ul>
  <div class="sidebar-spacer" aria-hidden="true"></div>
</aside>

<main>
  {% block content %}{% endblock %}
</main>

<footer class="main-footer">
  <div class="container footer-top">
    <div class="footer-brand">
      <h4>استیرا</h4>
      <p>تجربه خرید آسان با پشتیبانی سریع، قیمت‌های منصفانه و ارسال مطمئن.</p>
    </div>
    <div class="footer-column">
      <h4>لینک‌های مفید</h4>
      <a href="{% url 'shop' %}">فروشگاه</a>
      <a href="{% url 'news_list' %}">اخبار</a>
      <a href="{% url 'faq' %}">سوالات متداول</a>
    </div>
    <div class="footer-column">
      <h4>ارتباط با ما</h4>
      <a href="{% url 'contact' %}">فرم تماس</a>
      <a href="{% url 'contact' %}">پشتیبانی مشتریان</a>
    </div>
    <div class="footer-column">
      <h4>اطلاعات تماس</h4>
      {% if company_phone %}
        <p>تلفن: <a href="tel:{{ company_phone }}" dir="ltr">{{ company_phone }}</a></p>
      {% endif %}
      {% if company_email %}
        <p>ایمیل: <a href="mailto:{{ company_email }}">{{ company_email }}</a></p>
      {% endif %}
      {% if company_whatsapp %}
        <p>واتساپ: <a href="https://wa.me/{{ company_whatsapp|cut:'+' }}" dir="ltr" target="_blank" rel="noopener">{{ company_whatsapp }}</a></p>
      {% endif %}
      {% if company_telegram %}
        <p>تلگرام: <a href="https://t.me/{{ company_telegram }}" target="_blank" rel="noopener">@{{ company_telegram }}</a></p>
      {% endif %}
      {% if company_address %}
        <p>آدرس: {{ company_address|linebreaksbr }}</p>
      {% endif %}
    </div>
  </div>
  <div class="container footer-bottom">
    <p>تمام حقوق برای استیرا محفوظ است.</p>
  </div>
</footer>

<div id="mini-cart-overlay" class="mini-cart-overlay" aria-hidden="true"></div>
<aside
  id="mini-cart-drawer"
  class="mini-cart-drawer"
  data-preview-url="{% url 'cart_preview' %}"
  data-remove-url="{% url 'cart_remove' %}"
  aria-label="سبد خرید"
  aria-hidden="true"
>
  <div class="mini-cart-header">
    <span class="mini-cart-title">سبد خرید</span>
    <button type="button" id="mini-cart-close" class="close-btn mini-cart-close-btn" aria-label="بستن">×</button>
  </div>
  <div id="mini-cart-alert" class="mini-cart-alert" role="status" aria-live="polite"></div>
  <div id="mini-cart-items" class="mini-cart-items">
    <p class="mini-cart-empty">سبد خرید شما خالی است.</p>
  </div>
  <div class="mini-cart-footer">
    <div class="mini-cart-total-row">
      <span>مجموع:</span>
      <strong id="mini-cart-total">0</strong>
      <span>تومان</span>
    </div>
    <div class="mini-cart-actions">
      <a href="{% url 'cart' %}" class="btn btn-outline small">دیدن سبد خرید</a>
      {% if user.is_authenticated %}
        <a href="{% url 'checkout' %}" class="btn btn-primary small">تسویه حساب</a>
      {% else %}
        <a href="{% url 'login' %}?next={% url 'checkout' %}" class="btn btn-primary small">تسویه حساب</a>
      {% endif %}
    </div>
  </div>
</aside>
<script src="{% static 'js/mini-cart.js' %}" defer></script>
{% if request.resolver_match.url_name == 'home' and public_promo %}
<script src="{% static 'js/banner.js' %}" defer></script>
{% endif %}
<script src="{% static 'js/sidebar.js' %}" defer></script>
<script src="{% static 'js/theme.js' %}" defer></script>
{% if user.is_authenticated %}
<script src="{% static 'js/user-menu.js' %}" defer></script>
{% endif %}
{% block extra_js %}{% endblock %}
</body>
</html>
